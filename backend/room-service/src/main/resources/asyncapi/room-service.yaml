asyncapi: 3.0.0
info:
  title: Room Service API
  version: 1.0.0
  description: |
    WebSocket API for room management. 
    Handles participant presence (join/leave) and room state orchestration (start voting, next category).
    Base WebSocket Endpoint: `ws://<host>/ws-room`

servers:
  development:
    host: localhost:8080/ws-room
    protocol: ws
    description: Development server using SockJS + STOMP

channels:
  roomActionChannel:
    address: /app/public/room/{roomCode}/{action}
    parameters:
      roomCode:
        description: Unique 7-digit code of the room.
      action:
        description: The action to perform.
        enum: [join, leave]
    messages:
      sendRoomAction:
        $ref: '#/components/messages/RoomMessage'
    description: Endpoint for participants to join or leave the room.

  roomTopicChannel:
    address: /topic/room/{roomCode}
    parameters:
      roomCode:
        description: Unique 7-digit code of the room.
    messages:
      receiveRoomUpdate:
        $ref: '#/components/messages/RoomMessage'
    description: Broadcast topic for all room-related events (state changes, new users).

operations:
  participantAction:
    action: receive
    channel:
      $ref: '#/channels/roomActionChannel'
    summary: Participant joins or leaves the room via WebSocket.

  roomBroadcast:
    action: send
    channel:
      $ref: '#/channels/roomTopicChannel'
    summary: Server broadcasts room status updates to all connected clients.

components:
  messages:
    RoomMessage:
      name: RoomMessage
      summary: Message for room state and participant updates.
      payload:
        type: object
        properties:
          type:
            $ref: '#/components/schemas/MessageType'
          userId:
            type: integer
            format: int64
            description: ID of the user performing the action or the room owner.
          username:
            type: string
            description: Display name of the participant.
          category:
            $ref: '#/components/schemas/CategoryKey'

  schemas:
    MessageType:
      type: string
      enum:
        - JOIN
        - LEAVE
        - ROOM_CLOSED
        - VOTING_STARTED
        - NEXT_CATEGORY
        - VOTING_FINISHED
      description: |
        - JOIN: New participant entered the lobby.
        - LEAVE: Participant left the lobby.
        - ROOM_CLOSED: Owner closed the room or left prematurely.
        - VOTING_STARTED: Owner triggered the start of the first category.
        - NEXT_CATEGORY: Owner switched to the next category in the set.
        - VOTING_FINISHED: All categories have been voted on.

    CategoryKey:
      type: object
      properties:
        categoryId:
          type: integer
          format: int64
      description: Data identifying the current category being voted on.