asyncapi: 3.0.0
info:
  title: Decision Service (Voting System) API
  version: 1.0.0
  description: |
    WebSocket API for real-time decision making. 
    This service handles voting sessions (Polls) using STOMP protocol.
    Base WebSocket Endpoint: `ws://<host>/ws-poll`

servers:
  development:
    host: localhost:8080/ws-poll
    protocol: ws
    description: Development server using SockJS + STOMP

channels:
  pollChannel:
    address: /app/poll/{roomCode}/{categoryId}
    parameters:
      roomCode:
        description: Unique code for the voting room.
      categoryId:
        description: ID of the category currently being voted on.
    messages:
      sendPollMessage:
        $ref: '#/components/messages/PollMessage'
    description: Endpoint for clients to send voting actions (Setup, Vote, End, etc.)

  topicChannel:
    address: /topic/poll/{roomCode}/{categoryId}
    parameters:
      roomCode:
        description: Unique code for the voting room.
      categoryId:
        description: ID of the category currently being voted on.
    messages:
      receivePollUpdate:
        $ref: '#/components/messages/PollMessage'
    description: Topic for broadcasting voting updates to all participants in a room.

operations:
  processVote:
    action: receive
    channel:
      $ref: '#/channels/pollChannel'
    summary: Client sends an action to the server.

  broadcastUpdate:
    action: send
    channel:
      $ref: '#/channels/topicChannel'
    summary: Server broadcasts updates to all room participants.

components:
  messages:
    PollMessage:
      name: PollMessage
      summary: Main message object for voting orchestration.
      payload:
        type: object
        properties:
          optionsId:
            type: array
            items:
              type: integer
              format: int64
            description: List of selected option IDs.
          messageType:
            $ref: '#/components/schemas/MessageType'
          participantsCount:
            type: integer
            description: Current number of participants in the room.

  schemas:
    MessageType:
      type: string
      enum:
        - SETUP
        - START
        - VOTE
        - MATCH
        - END
        - UPDATE_PARTICIPANT_COUNT
        - INCREASE_VOTED_COUNT
      description: |
        - SETUP: Initialize the poll.
        - START: Server signals poll has started.
        - VOTE: User submits a choice.
        - MATCH: (SWIPE mode) All participants chose the same option.
        - END: (PICK mode) All participants finished voting.
        - UPDATE_PARTICIPANT_COUNT: Sync room size.
        - INCREASE_VOTED_COUNT: Sync how many people have already voted.